<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management - Brainiac Admin</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="sidebar.js"></script>
    <script src="addstudent.js"></script>

    <style>
      .page-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .toolbar {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }
      .search-box {
        flex-grow: 2;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
      }
      .filter-select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        min-width: 150px;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        color: white;
        transition: 0.2s;
      }
      .btn-add {
        background: var(--brand-orange);
      }
      .btn-bulk {
        background: #333;
      }
      .btn-outline {
        background: white;
        border: 1px solid #333;
        color: #333;
      }
      .table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        overflow-x: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
      }
      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #f9f9f9;
        color: #666;
        font-size: 0.85rem;
        text-transform: uppercase;
      }
      tr:hover {
        background: #fffcf8;
      }
      .status-toggle {
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
        user-select: none;
      }
      .active-bdg {
        background: #e8f5e9;
        color: #28a745;
        border: 1px solid #c8e6c9;
      }
      .inactive-bdg {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
      }
      .action-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2rem;
        margin-right: 10px;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: white;
        padding: 25px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        font-size: 0.9rem;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
      }
      .bulk-instruction {
        background: #e3f2fd;
        color: #0d47a1;
        padding: 10px;
        border-radius: 6px;
        font-size: 0.85rem;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="page-container">
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        "
      >
        <h2 style="margin: 0">Student Master List</h2>
        <div style="font-size: 0.9rem; color: #666" id="student-count">
          0 Students
        </div>
      </div>

      <div class="toolbar">
        <input
          type="text"
          id="search-input"
          class="search-box"
          placeholder="Search by Name or Phone..."
          onkeyup="filterLocal()"
        />
        <select
          id="branch-filter"
          class="filter-select"
          onchange="loadStudents()"
        >
          <option value="all">All Branches</option>
        </select>
        <select
          id="status-filter"
          class="filter-select"
          onchange="loadStudents()"
        >
          <option value="active">Active Only</option>
          <option value="inactive">Inactive/Left</option>
          <option value="all">Show All</option>
        </select>
        <button class="btn btn-add" onclick="openModal('add-modal')">
          + Single
        </button>
        <button class="btn btn-bulk" onclick="openModal('bulk-modal')">
          Bulk Add
        </button>
      </div>

      <div class="table-container">
        <table>
          <thead>
    <tr>
        <th>Name / Father</th> <th>Phone</th>
        <th>Branch</th>
        <th>School</th>        <th>Fee (₹)</th>
        <th>Due Day</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
</thead>


<div id="add-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;"> <h3>Add New Student</h3>
        <form id="single-form">
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="form-group" style="grid-column: span 2;">
                    <label>Branch</label>
                    <select id="m-branch" required></select>
                </div>
                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" id="m-name" placeholder="Student Name" required>
                </div>
                <div class="form-group">
                    <label>Father's Name</label>
                    <input type="text" id="m-father" placeholder="Father Name">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="m-phone" placeholder="10 digit number" required>
                </div>
                <div class="form-group">
                    <label>School Name</label>
                    <input type="text" id="m-school" placeholder="School Name">
                </div>
                
                <div class="form-group">
                    <label>Fee Amount (₹)</label>
                    <input type="number" id="m-fee" placeholder="5000" required>
                </div>
                <div class="form-group">
                    <label>Billing Day</label>
                    <input type="number" id="m-day" placeholder="8" min="1" max="28" required>
                </div>

                <div class="form-group">
                    <label>Sibling Name</label>
                    <input type="text" id="m-sibling" placeholder="If any">
                </div>
                <div class="form-group">
                    <label>Current Education</label>
                    <input type="text" id="m-edu" placeholder="Class 10, B.Tech...">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Parent Education/Occupation</label>
                    <input type="text" id="m-parent-edu" placeholder="Details about parents...">
                </div>
            </div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button type="button" class="btn" style="background:#eee; color:#333; flex:1" onclick="closeModal('add-modal')">Cancel</button>
                <button type="submit" class="btn btn-add" style="flex:1">Save Student</button>
            </div>
        </form>
    </div>
</div> 

          <tbody id="student-table-body">
            <!-- Rows will be populated here -->
          </tbody>
        </table>
      </div>

    <div id="bulk-modal" class="modal">
      <div class="modal-content">
        <h3>Bulk Add Students</h3>

        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
          "
        >
          <div style="font-size: 0.9rem; color: #666">Use CSV format</div>
          <button
            class="btn btn-outline"
            style="padding: 5px 10px; font-size: 0.8rem"
            onclick="downloadCSVTemplate()"
          >
            Download Template
          </button>
        </div>

        <div class="bulk-instruction">
          <strong>Order:</strong> Student Name, Phone, Fee, Day<br />
          <i>(Copy from Excel and paste below)</i>
        </div>

        <div class="form-group">
          <label>Select Branch for these students:</label>
          <select id="bulk-branch" required></select>
        </div>

        <div class="form-group">
          <label>Paste Data Here</label>
          <textarea
            id="bulk-text"
            rows="8"
            placeholder="Name, Phone, Fee, Day"
            style="font-family: monospace"
          ></textarea>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 10px">
          <button
            type="button"
            class="btn"
            style="background: #eee; color: #333; flex: 1"
            onclick="closeModal('bulk-modal')"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-bulk"
            style="flex: 1"
            onclick="processBulk()"
          >
            Upload All
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
